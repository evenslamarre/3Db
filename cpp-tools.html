<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calcul d'Aire, Volume et Mesures</title>
  <!-- Include MathJax for beautiful formula rendering -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    /* Full-page responsive design */
    * { box-sizing: border-box; }
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
    }
    header {
      background: #2d89ef;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    nav {
      background: #1b5eaa;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem;
    }
    nav button {
      background: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }
    nav button:hover {
      background: #e0e0e0;
    }
    main {
      padding: 1rem 2rem;
      height: calc(100% - 140px);
      overflow-y: auto;
    }
    .section {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    .section.active {
      display: block;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    label {
      font-weight: bold;
      margin-bottom: 0.3rem;
      display: block;
    }
    input, select {
      padding: 0.5rem;
      width: 100%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button.action {
      background: #2d89ef;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    button.action:hover {
      background: #1b5eaa;
    }
    pre.result {
      background: #eef;
      padding: 1rem;
      border-radius: 5px;
      white-space: pre-wrap;
      margin-top: 1rem;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <h1>Calcul d'Aire, Volume et Mesures</h1>
  </header>
  <nav>
    <button data-target="menuPrincipal">Menu Principal</button>
    <button data-target="formes2D">Formes 2D</button>
    <button data-target="solides3D">Solides 3D</button>
    <button data-target="mesuresAire">Mesures par Aire</button>
    <button data-target="mesuresVolume">Mesures par Volume</button>
  </nav>
  <main>
    <!-- MENU PRINCIPAL -->
    <section id="menuPrincipal" class="section active">
      <h2>Menu Principal</h2>
      <p>Sélectionnez une fonctionnalité dans la barre de navigation ci-dessus.</p>
    </section>

    <!-- FORMES 2D -->
    <section id="formes2D" class="section">
      <h2>Formes 2D</h2>
      <p>Choisissez une forme et entrez ses dimensions pour voir ses formules et résultats.</p>
      <div class="form-group">
        <label for="base2DSelect">Type de base 2D :</label>
        <select id="base2DSelect">
          <option value="carre">Carré</option>
          <option value="rectangle">Rectangle</option>
          <option value="cercle">Cercle</option>
          <option value="polygone">Polygone Régulier</option>
          <option value="trapeze">Trapèze Isocèle</option>
          <option value="losange">Losange</option>
        </select>
      </div>
      <div id="base2DForm"></div>
      <button class="action" onclick="calculer2D()">Calculer 2D</button>
      <pre id="result2D" class="result"></pre>
    </section>

    <!-- SOLIDES 3D -->
    <section id="solides3D" class="section">
      <h2>Solides 3D</h2>
      <p>Choisissez un solide 3D et entrez ses dimensions pour voir les formules et résultats.</p>
      <div class="form-group">
        <label for="solide3DSelect">Type de solide 3D :</label>
        <select id="solide3DSelect">
          <option value="prisme">Prisme (base 2D au choix)</option>
          <option value="cube">Cube</option>
          <option value="conePyramide">Cône / Pyramide (base 2D au choix)</option>
          <option value="sphere">Sphère</option>
          <option value="cylindre">Cylindre</option>
        </select>
      </div>
      <div id="solide3DForm"></div>
      <button class="action" onclick="calculer3D()">Calculer 3D</button>
      <pre id="result3D" class="result"></pre>
    </section>

    <!-- MESURES A PARTIR D'UNE AIRE -->
    <section id="mesuresAire" class="section">
      <h2>Mesures à partir d'une Aire</h2>
      <div class="form-group">
        <label for="inputAire">Entrez une aire (u²) :</label>
        <input type="number" id="inputAire" placeholder="Ex. 25">
      </div>
      <button class="action" onclick="calculerMesuresAire()">Calculer</button>
      <pre id="resultAire" class="result"></pre>
    </section>

    <!-- MESURES A PARTIR D'UN VOLUME -->
    <section id="mesuresVolume" class="section">
      <h2>Mesures à partir d'un Volume</h2>
      <div class="form-group">
        <label for="inputVolume">Entrez un volume (u³) :</label>
        <input type="number" id="inputVolume" placeholder="Ex. 125">
      </div>
      <button class="action" onclick="calculerMesuresVolume()">Calculer</button>
      <pre id="resultVolume" class="result"></pre>
    </section>
  </main>

  <script>
    /**********************
     * Navigation entre sections
     **********************/
    document.querySelectorAll("nav button").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        document.querySelectorAll("main .section").forEach(sec => {
          sec.classList.remove("active");
        });
        document.getElementById(target).classList.add("active");
      });
    });

    /**********************
     * 2D CLASSES ET FONCTIONS
     **********************/
    // Base class for 2D shapes
    class BaseShape2D {
      saisirDonnees() { /* implemented in subclass */ }
      getAire() { throw "Not implemented"; }
      getPerimetre() { throw "Not implemented"; }
      afficherFormulesEtResultat() { throw "Not implemented"; }
    }

    class Carre extends BaseShape2D {
      constructor(cote) {
        super();
        this.cote = cote;
      }
      getAire() { return this.cote * this.cote; }
      getPerimetre() { return 4 * this.cote; }
      afficherFormulesEtResultat() {
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du carré:
\\( A = c^2 \\)
\\( P = 4\\,c \\)

Donnée : \\( c = ${this.cote} \\)

Résultats :
\\( A = ${A} \\quad u^2 \\)
\\( P = ${P} \\quad u \\)
`;
      }
    }

    class Rectangle extends BaseShape2D {
      constructor(longueur, largeur) {
        super();
        this.longueur = longueur;
        this.largeur = largeur;
      }
      getAire() { return this.longueur * this.largeur; }
      getPerimetre() { return 2 * (this.longueur + this.largeur); }
      afficherFormulesEtResultat() {
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du rectangle:
\\( A = l \\times L \\)
\\( P = 2(l + L) \\)

Données : \\( l = ${this.longueur}, \\quad L = ${this.largeur} \\)

Résultats :
\\( A = ${A} \\quad u^2 \\)
\\( P = ${P} \\quad u \\)
`;
      }
    }

    class Cercle extends BaseShape2D {
      constructor(rayon) {
        super();
        this.rayon = rayon;
      }
      getAire() { return Math.PI * this.rayon * this.rayon; }
      getPerimetre() { return 2 * Math.PI * this.rayon; }
      afficherFormulesEtResultat() {
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du cercle:
\\( A = \\pi\\,r^2 \\)
\\( P = 2\\,\\pi\\,r \\)

Donnée : \\( r = ${this.rayon} \\)

Résultats :
\\( A = ${A.toFixed(3)} \\quad u^2 \\)
\\( P = ${P.toFixed(3)} \\quad u \\)
`;
      }
    }

    class PolygoneRegulier extends BaseShape2D {
      constructor(nbCotes, longueurCote) {
        super();
        this.nbCotes = nbCotes;
        this.longueurCote = longueurCote;
      }
      getApotheme() {
        return this.longueurCote / (2 * Math.tan(Math.PI / this.nbCotes));
      }
      getAire() {
        const a = this.getApotheme();
        return 0.5 * this.nbCotes * this.longueurCote * a;
      }
      getPerimetre() {
        return this.nbCotes * this.longueurCote;
      }
      afficherFormulesEtResultat() {
        const a = this.getApotheme();
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du polygone régulier (${this.nbCotes} côtés):
\\( A = \\frac{n\\,c\\,a}{2} \\)
\\( P = n\\,c \\)
\\( a = \\frac{c}{2\\,\\tan(\\pi/n)} \\)

Données : \\( n = ${this.nbCotes}, \\quad c = ${this.longueurCote} \\)

Résultats :
\\( a = ${a.toFixed(3)} \\quad u \\)
\\( A = ${A.toFixed(3)} \\quad u^2 \\)
\\( P = ${P.toFixed(3)} \\quad u \\)
`;
      }
    }

    class TrapezeIsocele extends BaseShape2D {
      constructor(grandeBase, petiteBase, hauteur) {
        super();
        // Swap if necessary
        if (grandeBase < petiteBase) {
          [grandeBase, petiteBase] = [petiteBase, grandeBase];
        }
        this.grandeBase = grandeBase;
        this.petiteBase = petiteBase;
        this.hauteur = hauteur;
      }
      getAire() {
        return ((this.grandeBase + this.petiteBase) / 2) * this.hauteur;
      }
      getPerimetre() {
        const diff = (this.grandeBase - this.petiteBase) / 2;
        const cote = Math.sqrt(this.hauteur * this.hauteur + diff * diff);
        return this.grandeBase + this.petiteBase + 2 * cote;
      }
      afficherFormulesEtResultat() {
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du trapèze isocèle:
\\( A = \\frac{(B+b)\\,h}{2} \\)
\\( c = \\sqrt{h^2 + \\left(\\frac{B-b}{2}\\right)^2} \\)
\\( P = B + b + 2\\,c \\)

Données : \\( B = ${this.grandeBase}, \\quad b = ${this.petiteBase}, \\quad h = ${this.hauteur} \\)

Résultats :
\\( A = ${A.toFixed(3)} \\quad u^2 \\)
\\( P = ${P.toFixed(3)} \\quad u \\)
`;
      }
    }

    class Losange extends BaseShape2D {
      constructor(grandeDiagonale, petiteDiagonale) {
        super();
        if (grandeDiagonale < petiteDiagonale) {
          [grandeDiagonale, petiteDiagonale] = [petiteDiagonale, grandeDiagonale];
        }
        this.grandeDiagonale = grandeDiagonale;
        this.petiteDiagonale = petiteDiagonale;
      }
      getAire() {
        return (this.grandeDiagonale * this.petiteDiagonale) / 2;
      }
      getPerimetre() {
        const demiD = this.grandeDiagonale / 2, demid = this.petiteDiagonale / 2;
        const cote = Math.sqrt(demiD * demiD + demid * demid);
        return 4 * cote;
      }
      afficherFormulesEtResultat() {
        const A = this.getAire(), P = this.getPerimetre();
        return `
Formules du losange:
\\( A = \\frac{D\\,d}{2} \\)
\\( c = \\sqrt{\\left(\\frac{D}{2}\\right)^2 + \\left(\\frac{d}{2}\\right)^2} \\)
\\( P = 4\\,c \\)

Données : \\( D = ${this.grandeDiagonale}, \\quad d = ${this.petiteDiagonale} \\)

Résultats :
\\( A = ${A.toFixed(3)} \\quad u^2 \\)
\\( P = ${P.toFixed(3)} \\quad u \\)
`;
      }
    }

    // Rendu du formulaire pour la base 2D
    function renderBase2DForm() {
      const type = document.getElementById("base2DSelect").value;
      let html = "";
      switch (type) {
        case "carre":
          html = `<div class="form-group">
                    <label for="carreCote">Longueur du côté (u) :</label>
                    <input type="number" id="carreCote" placeholder="Ex. 5">
                  </div>`;
          break;
        case "rectangle":
          html = `<div class="form-group">
                    <label for="rectLongueur">Longueur (u) :</label>
                    <input type="number" id="rectLongueur" placeholder="Ex. 8">
                  </div>
                  <div class="form-group">
                    <label for="rectLargeur">Largeur (u) :</label>
                    <input type="number" id="rectLargeur" placeholder="Ex. 4">
                  </div>`;
          break;
        case "cercle":
          html = `<div class="form-group">
                    <label for="cercleRayon">Rayon (u) :</label>
                    <input type="number" id="cercleRayon" placeholder="Ex. 3">
                  </div>`;
          break;
        case "polygone":
          html = `<div class="form-group">
                    <label for="polyNbCotes">Nombre de côtés :</label>
                    <input type="number" id="polyNbCotes" placeholder="Ex. 5">
                  </div>
                  <div class="form-group">
                    <label for="polyLongueur">Longueur d'un côté (u) :</label>
                    <input type="number" id="polyLongueur" placeholder="Ex. 4">
                  </div>`;
          break;
        case "trapeze":
          html = `<div class="form-group">
                    <label for="trapGrandeBase">Grande base (u) :</label>
                    <input type="number" id="trapGrandeBase" placeholder="Ex. 10">
                  </div>
                  <div class="form-group">
                    <label for="trapPetiteBase">Petite base (u) :</label>
                    <input type="number" id="trapPetiteBase" placeholder="Ex. 6">
                  </div>
                  <div class="form-group">
                    <label for="trapHauteur">Hauteur (u) :</label>
                    <input type="number" id="trapHauteur" placeholder="Ex. 4">
                  </div>`;
          break;
        case "losange":
          html = `<div class="form-group">
                    <label for="losangeGrandeDiag">Grande diagonale (u) :</label>
                    <input type="number" id="losangeGrandeDiag" placeholder="Ex. 8">
                  </div>
                  <div class="form-group">
                    <label for="losangePetiteDiag">Petite diagonale (u) :</label>
                    <input type="number" id="losangePetiteDiag" placeholder="Ex. 6">
                  </div>`;
          break;
        default:
          html = "";
      }
      document.getElementById("base2DForm").innerHTML = html;
    }
    document.getElementById("base2DSelect").addEventListener("change", renderBase2DForm);
    renderBase2DForm();  // initial render

    // Function to calculate and display 2D results
    function calculer2D() {
      const type = document.getElementById("base2DSelect").value;
      let shape, resultText = "";
      switch (type) {
        case "carre":
          {
            const cote = parseFloat(document.getElementById("carreCote").value);
            if (isNaN(cote) || cote <= 0) { resultText = "Veuillez entrer une valeur positive pour le côté."; break; }
            shape = new Carre(cote);
          }
          break;
        case "rectangle":
          {
            const l = parseFloat(document.getElementById("rectLongueur").value);
            const L = parseFloat(document.getElementById("rectLargeur").value);
            if (isNaN(l) || isNaN(L) || l <= 0 || L <= 0) { resultText = "Veuillez entrer des valeurs positives pour la longueur et la largeur."; break; }
            shape = new Rectangle(l, L);
          }
          break;
        case "cercle":
          {
            const r = parseFloat(document.getElementById("cercleRayon").value);
            if (isNaN(r) || r <= 0) { resultText = "Veuillez entrer un rayon positif."; break; }
            shape = new Cercle(r);
          }
          break;
        case "polygone":
          {
            const n = parseInt(document.getElementById("polyNbCotes").value, 10);
            const c = parseFloat(document.getElementById("polyLongueur").value);
            if (isNaN(n) || n < 3 || isNaN(c) || c <= 0) { resultText = "Veuillez entrer un nombre de côtés (>= 3) et une longueur positive."; break; }
            shape = new PolygoneRegulier(n, c);
          }
          break;
        case "trapeze":
          {
            const B = parseFloat(document.getElementById("trapGrandeBase").value);
            const b = parseFloat(document.getElementById("trapPetiteBase").value);
            const h = parseFloat(document.getElementById("trapHauteur").value);
            if (isNaN(B) || isNaN(b) || isNaN(h) || B <= 0 || b <= 0 || h <= 0) { resultText = "Veuillez entrer des valeurs positives."; break; }
            shape = new TrapezeIsocele(B, b, h);
          }
          break;
        case "losange":
          {
            const D = parseFloat(document.getElementById("losangeGrandeDiag").value);
            const d = parseFloat(document.getElementById("losangePetiteDiag").value);
            if (isNaN(D) || isNaN(d) || D <= 0 || d <= 0) { resultText = "Veuillez entrer des valeurs positives pour les diagonales."; break; }
            shape = new Losange(D, d);
          }
          break;
        default:
          resultText = "Type de forme inconnu.";
      }
      if (shape) {
        resultText = shape.afficherFormulesEtResultat();
      }
      document.getElementById("result2D").textContent = resultText;
      MathJax.typesetPromise();
    }

    /**********************
     * 3D CLASSES ET FONCTIONS
     **********************/
    // Base class for 3D shapes
    class Shape3D {
      calculerAireLaterale() { throw "Not implemented"; }
      calculerAireTotale() { throw "Not implemented"; }
      calculerVolume() { throw "Not implemented"; }
      afficherFormulesEtResultats() { throw "Not implemented"; }
    }

    class Prisme extends Shape3D {
      constructor(aireBase, hauteur) {
        super();
        this.aireBase = aireBase;
        this.hauteur = hauteur;
      }
      calculerAireLaterale() {
        // In our simplified version, we assume the base is a square so that
        // the perimeter is approximated as 4*sqrt(aireBase)
        const p = 4 * Math.sqrt(this.aireBase);
        return p * this.hauteur;
      }
      calculerAireTotale() {
        return this.calculerAireLaterale() + 2 * this.aireBase;
      }
      calculerVolume() {
        return this.aireBase * this.hauteur;
      }
      afficherFormulesEtResultats() {
        const A_base = this.aireBase;
        const P_base = 4 * Math.sqrt(this.aireBase);
        const Al = this.calculerAireLaterale();
        const At = this.calculerAireTotale();
        const V = this.calculerVolume();
        return `
Prisme :
\\( A_{lat} = P_{base} \\times h \\)
\\( A_{tot} = A_{lat} + 2\\,A_{base} \\)
\\( V = A_{base} \\times h \\)

Données :
\\( A_{base} = ${A_base} \\quad u^2 \\)
\\( P_{base} \\approx ${P_base.toFixed(3)} \\quad u \\)
\\( h = ${this.hauteur} \\quad u \\)

Résultats :
\\( A_{lat} \\approx ${Al.toFixed(3)} \\quad u^2 \\)
\\( A_{tot} \\approx ${At.toFixed(3)} \\quad u^2 \\)
\\( V \\approx ${V.toFixed(3)} \\quad u^3 \\)
`;
      }
    }

    class Cube extends Shape3D {
      constructor(cote) {
        super();
        this.cote = cote;
      }
      calculerAireLaterale() { return 4 * this.cote * this.cote; }
      calculerAireTotale() { return 6 * this.cote * this.cote; }
      calculerVolume() { return Math.pow(this.cote, 3); }
      afficherFormulesEtResultats() {
        const Al = this.calculerAireLaterale(), At = this.calculerAireTotale(), V = this.calculerVolume();
        return `
Cube :
\\( A_{lat} = 4\\,c^2 \\)
\\( A_{tot} = 6\\,c^2 \\)
\\( V = c^3 \\)

Donnée : \\( c = ${this.cote} \\quad u \\)

Résultats :
\\( A_{lat} = ${Al} \\quad u^2 \\)
\\( A_{tot} = ${At} \\quad u^2 \\)
\\( V = ${V} \\quad u^3 \\)
`;
      }
    }

    class ConePyramide extends Shape3D {
      // In this class, if the base is circular then we consider it a cone;
      // otherwise, a pyramid. We simulate this by passing a flag.
      constructor(baseShape, hauteur, baseEstCercle) {
        super();
        this.baseShape = baseShape; // instance of a 2D base shape
        this.hauteur = hauteur;
        this.baseEstCercle = baseEstCercle;
        // Automatic computation of generatrice:
        if (baseEstCercle) {
          this.generatrice = Math.sqrt(Math.pow(this.baseShape.rayon, 2) + hauteur * hauteur);
        } else {
          // For simplicity, if the base is a square or rectangle we approximate the apotheme.
          if (this.baseShape instanceof Carre) {
            const aBase = this.baseShape.cote / 2;
            this.generatrice = Math.sqrt(hauteur * hauteur + aBase * aBase);
          } else if (this.baseShape instanceof Rectangle) {
            const aBase = Math.min(this.baseShape.longueur, this.baseShape.largeur) / 2;
            this.generatrice = Math.sqrt(hauteur * hauteur + aBase * aBase);
          } else if (this.baseShape instanceof PolygoneRegulier) {
            const aBase = this.baseShape.getApotheme();
            this.generatrice = Math.sqrt(hauteur * hauteur + aBase * aBase);
          } else {
            // Otherwise, ask user to provide it (here we default)
            this.generatrice = hauteur; // dummy value
          }
        }
      }
      calculerAireLaterale() {
        if (this.baseEstCercle) {
          return Math.PI * this.baseShape.rayon * this.generatrice;
        } else {
          return (this.baseShape.getPerimetre() * this.generatrice) / 2;
        }
      }
      calculerAireTotale() {
        return this.calculerAireLaterale() + this.baseShape.getAire();
      }
      calculerVolume() {
        return (1/3) * this.baseShape.getAire() * this.hauteur;
      }
      afficherFormulesEtResultats() {
        let result = "";
        if (this.baseEstCercle) {
          result = `
Cône :
\\( g = \\sqrt{r^2+h^2} \\)
\\( A_{base} = \\pi\\,r^2 \\)
\\( A_{lat} = \\pi\\,r\\,g \\)
\\( A_{tot} = A_{lat} + A_{base} \\)
\\( V = \\frac{1}{3}\\,A_{base}\\,h \\)

Données :
\\( r = ${this.baseShape.rayon} \\quad u \\)
\\( h = ${this.hauteur} \\quad u \\)
\\( g \\approx ${this.generatrice.toFixed(3)} \\quad u \\)

Résultats :
\\( A_{base} \\approx ${this.baseShape.getAire().toFixed(3)} \\quad u^2 \\)
\\( A_{lat} \\approx ${this.calculerAireLaterale().toFixed(3)} \\quad u^2 \\)
\\( A_{tot} \\approx ${this.calculerAireTotale().toFixed(3)} \\quad u^2 \\)
\\( V \\approx ${this.calculerVolume().toFixed(3)} \\quad u^3 \\)
`;
        } else {
          result = `
Pyramide :
\\( A_{lat} = \\frac{P_{base}\\,g}{2} \\)
\\( A_{tot} = A_{lat} + A_{base} \\)
\\( V = \\frac{1}{3}\\,A_{base}\\,h \\)

Données :
\\( A_{base} = ${this.baseShape.getAire().toFixed(3)} \\quad u^2 \\)
\\( P_{base} = ${this.baseShape.getPerimetre().toFixed(3)} \\quad u \\)
\\( h = ${this.hauteur} \\quad u \\)
\\( g \\approx ${this.generatrice.toFixed(3)} \\quad u \\)

Résultats :
\\( A_{lat} \\approx ${this.calculerAireLaterale().toFixed(3)} \\quad u^2 \\)
\\( A_{tot} \\approx ${this.calculerAireTotale().toFixed(3)} \\quad u^2 \\)
\\( V \\approx ${this.calculerVolume().toFixed(3)} \\quad u^3 \\)
`;
        }
        return result;
      }
    }

    class Sphere extends Shape3D {
      constructor(rayon) {
        super();
        this.rayon = rayon;
      }
      calculerAireTotale() { return 4 * Math.PI * this.rayon * this.rayon; }
      calculerAireLaterale() { return this.calculerAireTotale(); }
      calculerVolume() { return (4/3) * Math.PI * Math.pow(this.rayon, 3); }
      afficherFormulesEtResultats() {
        return `
Sphère :
\\( A = 4\\,\\pi\\,r^2 \\)
\\( V = \\frac{4}{3}\\,\\pi\\,r^3 \\)

Donnée : \\( r = ${this.rayon} \\quad u \\)

Résultats :
\\( A \\approx ${this.calculerAireTotale().toFixed(3)} \\quad u^2 \\)
\\( V \\approx ${this.calculerVolume().toFixed(3)} \\quad u^3 \\)
`;
      }
    }

    class Cylindre extends Shape3D {
      constructor(rayon, hauteur) {
        super();
        this.rayon = rayon;
        this.hauteur = hauteur;
      }
      calculerAireLaterale() { return 2 * Math.PI * this.rayon * this.hauteur; }
      calculerAireTotale() { return this.calculerAireLaterale() + 2 * Math.PI * this.rayon * this.rayon; }
      calculerVolume() { return Math.PI * this.rayon * this.rayon * this.hauteur; }
      afficherFormulesEtResultats() {
        return `
Cylindre :
\\( A_{lat} = 2\\,\\pi\\,r\\,h \\)
\\( A_{tot} = A_{lat} + 2\\,\\pi\\,r^2 \\)
\\( V = \\pi\\,r^2\\,h \\)

Données :
\\( r = ${this.rayon} \\quad u \\)
\\( h = ${this.hauteur} \\quad u \\)

Résultats :
\\( A_{lat} \\approx ${this.calculerAireLaterale().toFixed(3)} \\quad u^2 \\)
\\( A_{tot} \\approx ${this.calculerAireTotale().toFixed(3)} \\quad u^2 \\)
\\( V \\approx ${this.calculerVolume().toFixed(3)} \\quad u^3 \\)
`;
      }
    }

    // Rendu du formulaire pour solide 3D
    function renderSolide3DForm() {
      const type = document.getElementById("solide3DSelect").value;
      let html = "";
      switch (type) {
        case "prisme":
          html = `<div class="form-group">
                    <label for="prismeAireBase">Aire de la base (u²) :</label>
                    <input type="number" id="prismeAireBase" placeholder="Ex. 25">
                  </div>
                  <div class="form-group">
                    <label for="prismeH">Hauteur (u) :</label>
                    <input type="number" id="prismeH" placeholder="Ex. 10">
                  </div>`;
          break;
        case "cube":
          html = `<div class="form-group">
                    <label for="cubeCote">Longueur de l'arête (u) :</label>
                    <input type="number" id="cubeCote" placeholder="Ex. 4">
                  </div>`;
          break;
        case "conePyramide":
          // For cone/pyramide, let user choose a 2D base as well.
          html = `<div class="form-group">
                    <label for="base2DFor3D">Type de base 2D pour le cône/pyramide :</label>
                    <select id="base2DFor3D">
                      <option value="cercle">Cercle (Cône)</option>
                      <option value="carre">Carré</option>
                      <option value="rectangle">Rectangle</option>
                      <option value="polygone">Polygone Régulier</option>
                      <option value="trapeze">Trapèze Isocèle</option>
                      <option value="losange">Losange</option>
                    </select>
                  </div>
                  <div id="base2DFor3DForm"></div>
                  <div class="form-group">
                    <label for="coneH">Hauteur (u) :</label>
                    <input type="number" id="coneH" placeholder="Ex. 8">
                  </div>`;
          break;
        case "sphere":
          html = `<div class="form-group">
                    <label for="sphereRayon">Rayon (u) :</label>
                    <input type="number" id="sphereRayon" placeholder="Ex. 3">
                  </div>`;
          break;
        case "cylindre":
          html = `<div class="form-group">
                    <label for="cylindreRayon">Rayon de la base (u) :</label>
                    <input type="number" id="cylindreRayon" placeholder="Ex. 3">
                  </div>
                  <div class="form-group">
                    <label for="cylindreH">Hauteur (u) :</label>
                    <input type="number" id="cylindreH" placeholder="Ex. 7">
                  </div>`;
          break;
        default:
          html = "";
      }
      document.getElementById("solide3DForm").innerHTML = html;
      if (type === "conePyramide") renderBase2DFor3DForm();
    }
    document.getElementById("solide3DSelect").addEventListener("change", renderSolide3DForm);
    renderSolide3DForm();

    // For cone/pyramide, render the inner 2D form
    function renderBase2DFor3DForm() {
      const type = document.getElementById("base2DFor3D").value;
      let html = "";
      switch (type) {
        case "cercle":
          html = `<div class="form-group">
                    <label for="coneCercleRayon">Rayon (u) :</label>
                    <input type="number" id="coneCercleRayon" placeholder="Ex. 3">
                  </div>`;
          break;
        case "carre":
          html = `<div class="form-group">
                    <label for="coneCarreCote">Longueur du côté (u) :</label>
                    <input type="number" id="coneCarreCote" placeholder="Ex. 4">
                  </div>`;
          break;
        case "rectangle":
          html = `<div class="form-group">
                    <label for="coneRectLongueur">Longueur (u) :</label>
                    <input type="number" id="coneRectLongueur" placeholder="Ex. 5">
                  </div>
                  <div class="form-group">
                    <label for="coneRectLargeur">Largeur (u) :</label>
                    <input type="number" id="coneRectLargeur" placeholder="Ex. 3">
                  </div>`;
          break;
        case "polygone":
          html = `<div class="form-group">
                    <label for="conePolyNbCotes">Nombre de côtés :</label>
                    <input type="number" id="conePolyNbCotes" placeholder="Ex. 6">
                  </div>
                  <div class="form-group">
                    <label for="conePolyLongueur">Longueur d'un côté (u) :</label>
                    <input type="number" id="conePolyLongueur" placeholder="Ex. 3">
                  </div>`;
          break;
        case "trapeze":
          html = `<div class="form-group">
                    <label for="coneTrapGrandeBase">Grande base (u) :</label>
                    <input type="number" id="coneTrapGrandeBase" placeholder="Ex. 8">
                  </div>
                  <div class="form-group">
                    <label for="coneTrapPetiteBase">Petite base (u) :</label>
                    <input type="number" id="coneTrapPetiteBase" placeholder="Ex. 5">
                  </div>
                  <div class="form-group">
                    <label for="coneTrapHauteur">Hauteur (u) :</label>
                    <input type="number" id="coneTrapHauteur" placeholder="Ex. 4">
                  </div>`;
          break;
        case "losange":
          html = `<div class="form-group">
                    <label for="coneLosangeGrandeDiag">Grande diagonale (u) :</label>
                    <input type="number" id="coneLosangeGrandeDiag" placeholder="Ex. 7">
                  </div>
                  <div class="form-group">
                    <label for="coneLosangePetiteDiag">Petite diagonale (u) :</label>
                    <input type="number" id="coneLosangePetiteDiag" placeholder="Ex. 5">
                  </div>`;
          break;
        default:
          html = "";
      }
      document.getElementById("base2DFor3DForm").innerHTML = html;
    }
    document.getElementById("base2DFor3D").addEventListener("change", renderBase2DFor3DForm);

    // Function to calculate 3D results
    function calculer3D() {
      const type = document.getElementById("solide3DSelect").value;
      let resultText = "";
      if (type === "prisme") {
        const A_base = parseFloat(document.getElementById("prismeAireBase").value);
        const h = parseFloat(document.getElementById("prismeH").value);
        if (isNaN(A_base) || A_base <= 0 || isNaN(h) || h <= 0) {
          resultText = "Veuillez entrer des valeurs positives pour l'aire de la base et la hauteur.";
        } else {
          const prisme = new Prisme(A_base, h);
          resultText = prisme.afficherFormulesEtResultats();
        }
      } else if (type === "cube") {
        const c = parseFloat(document.getElementById("cubeCote").value);
        if (isNaN(c) || c <= 0) {
          resultText = "Veuillez entrer une valeur positive pour l'arête.";
        } else {
          const cube = new Cube(c);
          resultText = cube.afficherFormulesEtResultats();
        }
      } else if (type === "conePyramide") {
        const baseType = document.getElementById("base2DFor3D").value;
        let baseShape = null;
        let baseEstCercle = false;
        if (baseType === "cercle") {
          const r = parseFloat(document.getElementById("coneCercleRayon").value);
          if (isNaN(r) || r <= 0) { resultText = "Entrez un rayon valide pour la base."; }
          else { baseShape = new Cercle(r); baseEstCercle = true; }
        } else if (baseType === "carre") {
          const cote = parseFloat(document.getElementById("coneCarreCote").value);
          if (isNaN(cote) || cote <= 0) { resultText = "Entrez une valeur positive pour le côté."; }
          else { baseShape = new Carre(cote); }
        } else if (baseType === "rectangle") {
          const l = parseFloat(document.getElementById("coneRectLongueur").value);
          const L = parseFloat(document.getElementById("coneRectLargeur").value);
          if (isNaN(l) || isNaN(L) || l <= 0 || L <= 0) { resultText = "Entrez des valeurs positives pour la longueur et la largeur."; }
          else { baseShape = new Rectangle(l, L); }
        } else if (baseType === "polygone") {
          const n = parseInt(document.getElementById("conePolyNbCotes").value, 10);
          const c = parseFloat(document.getElementById("conePolyLongueur").value);
          if (isNaN(n) || n < 3 || isNaN(c) || c <= 0) { resultText = "Entrez un nombre de côtés (>=3) et une longueur positive."; }
          else { baseShape = new PolygoneRegulier(n, c); }
        } else if (baseType === "trapeze") {
          const B = parseFloat(document.getElementById("coneTrapGrandeBase").value);
          const b = parseFloat(document.getElementById("coneTrapPetiteBase").value);
          const hTrap = parseFloat(document.getElementById("coneTrapHauteur").value);
          if (isNaN(B) || isNaN(b) || isNaN(hTrap) || B <= 0 || b <= 0 || hTrap <= 0) { resultText = "Entrez des valeurs positives pour le trapèze."; }
          else { baseShape = new TrapezeIsocele(B, b, hTrap); }
        } else if (baseType === "losange") {
          const D = parseFloat(document.getElementById("coneLosangeGrandeDiag").value);
          const d = parseFloat(document.getElementById("coneLosangePetiteDiag").value);
          if (isNaN(D) || isNaN(d) || D <= 0 || d <= 0) { resultText = "Entrez des valeurs positives pour les diagonales."; }
          else { baseShape = new Losange(D, d); }
        }
        const h = parseFloat(document.getElementById("coneH").value);
        if (!baseShape) {
          resultText = resultText || "Base invalide.";
        } else if (isNaN(h) || h <= 0) {
          resultText = "Entrez une hauteur positive.";
        } else {
          const cp = new ConePyramide(baseShape, h, baseEstCercle);
          resultText = cp.afficherFormulesEtResultats();
        }
      } else if (type === "sphere") {
        const r = parseFloat(document.getElementById("sphereRayon").value);
        if (isNaN(r) || r <= 0) {
          resultText = "Entrez un rayon positif.";
        } else {
          const sphere = new Sphere(r);
          resultText = sphere.afficherFormulesEtResultats();
        }
      } else if (type === "cylindre") {
        const r = parseFloat(document.getElementById("cylindreRayon").value);
        const h = parseFloat(document.getElementById("cylindreH").value);
        if (isNaN(r) || r <= 0 || isNaN(h) || h <= 0) {
          resultText = "Entrez des valeurs positives pour le rayon et la hauteur.";
        } else {
          const cyl = new Cylindre(r, h);
          resultText = cyl.afficherFormulesEtResultats();
        }
      }
      document.getElementById("result3D").textContent = resultText;
      MathJax.typesetPromise();
    }

    /**********************
     * MESURES À PARTIR D'UNE AIRE / VOLUME
     **********************/
    function calculerMesuresAire() {
      const aire = parseFloat(document.getElementById("inputAire").value);
      let output = "";
      if (isNaN(aire) || aire <= 0) {
        output = "Entrez une aire positive.";
      } else {
        output += `Pour une aire \\( A = ${aire} \\quad u^2 \\), exemples :\n\n`;
        // Cone examples: using A = pi*r*g + pi*r^2 ; we solve for g
        for (let r = 1.0; r <= Math.sqrt(aire); r += 0.1) {
          let g = (aire - (Math.PI * r * r)) / (Math.PI * r);
          let h = Math.sqrt(g * g - r * r);
          if (g > 0 && validThousandths(g) &&
              (r / g > 0.30) && (g / r > 0.30) &&
              (h / r > 0.30) && (h / g > 0.40)) {
            output += `Cône : \\( r = ${r.toFixed(1)},\\ g \\approx ${g.toFixed(3)},\\ h \\approx ${h.toFixed(2)} \\)\n`;
          }
        }
        // Sphere example
        let rSphere = Math.sqrt(aire / (4 * Math.PI));
        output += `\nSphère : \\( r = \\sqrt{\\frac{A}{4\\pi}} \\approx ${rSphere.toFixed(3)} \\)\n`;
      }
      document.getElementById("resultAire").textContent = output;
      MathJax.typesetPromise();
    }

    function calculerMesuresVolume() {
      const volume = parseFloat(document.getElementById("inputVolume").value);
      let output = "";
      if (isNaN(volume) || volume <= 0) {
        output = "Entrez un volume positif.";
      } else {
        output += `Pour un volume \\( V = ${volume} \\quad u^3 \\), exemples :\n\n`;
        // Cone example: V = (1/3)*pi*r^2*h  => h = 3V/(pi*r^2)
        for (let r = 0.5; r <= Math.cbrt(volume); r += 0.1) {
          let h = (3 * volume) / (Math.PI * r * r);
          let g = Math.sqrt(r * r + h * h);
          if (g > 0 && validThousandths(g))
            output += `Cône : \\( r = ${r.toFixed(1)},\\ h \\approx ${h.toFixed(3)},\\ g \\approx ${g.toFixed(3)} \\)\n`;
        }
        // Sphere example: V = 4/3*pi*r^3  => r = cube root((3V)/(4pi))
        let rSphere = Math.cbrt((3 * volume) / (4 * Math.PI));
        output += `\nSphère : \\( r = \\sqrt[3]{\\frac{3V}{4\\pi}} \\approx ${rSphere.toFixed(3)} \\)\n`;
      }
      document.getElementById("resultVolume").textContent = output;
      MathJax.typesetPromise();
    }

    // Utility: check if the thousandth digit is 0 or 1
    function validThousandths(value) {
      const digit = Math.floor(Math.abs(value) * 1000) % 10;
      return (digit === 0 || digit === 1);
    }
  </script>
</body>
</html>
