<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3Db - Geometry Calculator (Refined)</title>
  <!-- Load MathJax for professional math rendering -->
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    /* Basic styling for a clean, user-friendly interface */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1em;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    h2 {
      margin-top: 0;
    }
    .menu button,
    .section button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 1.1em;
    }
    select,
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      box-sizing: border-box;
      font-size: 1em;
    }
    .back-btn {
      margin-top: 20px;
    }
    .result {
      margin-top: 20px;
      background: #e8f4ff;
      padding: 10px;
      border-left: 4px solid #0066cc;
      /* We use white-space: normal so we can have HTML-based content (MathJax) */
      white-space: normal;
    }
    .step-title {
      font-weight: bold;
      margin-top: 0.5em;
    }
    .formula {
      background: #f0f0f0;
      padding: 5px;
      margin: 5px 0;
      font-family: serif;
      /* We rely on MathJax to transform TeX inside here. */
    }
  </style>
</head>

<body>
  <header>
    <h1>3Db Geometry Calculator (Refined)</h1>
  </header>
  <div class="container">
    <!-- Main Menu -->
    <div id="mainMenu" class="menu">
      <h2>Main Menu</h2>
      <button onclick="showSection('2D')">1. 2D Shapes (Area &amp; Perimeter)</button>
      <button onclick="showSection('3D')">2. 3D Solids</button>
      <button onclick="showSection('measureArea')">3. Measures from a Specific Area</button>
      <button onclick="showSection('measureVolume')">4. Measures from a Specific Volume</button>
      <button onclick="exitProgram()">5. Quit</button>
    </div>

    <!-- 2D Shapes Section -->
    <div id="section2D" class="section" style="display:none;">
      <h2>2D Shapes</h2>
      <p>Select a shape:</p>
      <select id="select2D">
        <option value="">--Select--</option>
        <option value="carre">Square (Carre)</option>
        <option value="rectangle">Rectangle</option>
        <option value="cercle">Circle (Cercle)</option>
        <option value="polygone">Regular Polygon (Polygone regulier)</option>
        <option value="trapeze">Isosceles Trapeze (Trapeze isocele)</option>
        <option value="losange">Rhombus (Losange)</option>
      </select>
      <div id="inputs2D"></div>
      <button onclick="compute2D()">Compute</button>
      <div id="result2D" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()">Back</button>
    </div>

    <!-- 3D Solids Section -->
    <div id="section3D" class="section" style="display:none;">
      <h2>3D Solids</h2>
      <p>Select a solid:</p>
      <select id="select3D">
        <option value="">--Select--</option>
        <option value="prisme">Prism</option>
        <option value="cube">Cube</option>
        <option value="conePyramide">Cone/Pyramid</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
      </select>
      <div id="inputs3D"></div>
      <button onclick="compute3D()">Compute</button>
      <div id="result3D" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()">Back</button>
    </div>

    <!-- Measures from a Specific Area Section -->
    <div id="sectionMeasureArea" class="section" style="display:none;">
      <h2>Measures from a Specific Area</h2>
      <p>Enter desired area (in u²):</p>
      <input type="number" id="inputArea" step="any" />
      <p>Select a solid type:</p>
      <select id="selectSolidArea">
        <option value="">--Select--</option>
        <option value="cone">Cone</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
        <option value="cube">Cube</option>
        <option value="prisme">Prism (square base)</option>
        <option value="pyramide">Pyramid (square base)</option>
      </select>
      <button onclick="computeMeasuresArea()">Find Dimensions</button>
      <div id="resultArea" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()">Back</button>
    </div>

    <!-- Measures from a Specific Volume Section -->
    <div id="sectionMeasureVolume" class="section" style="display:none;">
      <h2>Measures from a Specific Volume</h2>
      <p>Enter desired volume (in u³):</p>
      <input type="number" id="inputVolume" step="any" />
      <p>Select a solid type:</p>
      <select id="selectSolidVolume">
        <option value="">--Select--</option>
        <option value="cone">Cone</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
        <option value="cube">Cube</option>
        <option value="prisme">Prism (square base)</option>
        <option value="pyramide">Pyramid (square base)</option>
      </select>
      <button onclick="computeMeasuresVolume()">Find Dimensions</button>
      <div id="resultVolume" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()">Back</button>
    </div>
  </div>

  <script>
    // --- Helper: If a number is an integer, no decimals; else 2 decimals.
    function fmt(num) {
      if (Math.abs(num - Math.round(num)) < 1e-9) {
        return Math.round(num).toString();
      } else {
        return num.toFixed(2);
      }
    }

    // Utility function from your C++ code, used in loops
    function validThousandths(value) {
      const digit = Math.floor(Math.abs(value) * 1000) % 10;
      return (digit === 0 || digit === 1);
    }

    // Navigation
    function showSection(section) {
      document.getElementById('mainMenu').style.display = 'none';
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      if (section === '2D') {
        document.getElementById('section2D').style.display = 'block';
      } else if (section === '3D') {
        document.getElementById('section3D').style.display = 'block';
      } else if (section === 'measureArea') {
        document.getElementById('sectionMeasureArea').style.display = 'block';
      } else if (section === 'measureVolume') {
        document.getElementById('sectionMeasureVolume').style.display = 'block';
      }
    }
    function backToMain() {
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      document.getElementById('mainMenu').style.display = 'block';
    }
    function exitProgram() {
      document.body.innerHTML = '<h1 style="text-align:center; margin-top:50px;">Goodbye!</h1>';
    }

    //================================================
    // 1) 2D SHAPES
    //================================================
    document.getElementById('select2D').addEventListener('change', function() {
      const shape = this.value;
      const container = document.getElementById('inputs2D');
      container.innerHTML = '';
      if (shape === 'carre') {
        container.innerHTML = '<label>Side (c):</label><input type="number" id="carre_c" step="any" />';
      } else if (shape === 'rectangle') {
        container.innerHTML = '<label>Length (L):</label><input type="number" id="rectangle_L" step="any" />' +
                              '<label>Width (l):</label><input type="number" id="rectangle_l" step="any" />';
      } else if (shape === 'cercle') {
        container.innerHTML = '<label>Radius (r):</label><input type="number" id="cercle_r" step="any" />';
      } else if (shape === 'polygone') {
        container.innerHTML = '<label>Number of sides (n):</label><input type="number" id="polygone_n" step="1" />' +
                              '<label>Side length (c):</label><input type="number" id="polygone_c" step="any" />';
      } else if (shape === 'trapeze') {
        container.innerHTML = '<label>Large Base (B):</label><input type="number" id="trapeze_B" step="any" />' +
                              '<label>Small Base (b):</label><input type="number" id="trapeze_b" step="any" />' +
                              '<label>Height (h):</label><input type="number" id="trapeze_h" step="any" />';
      } else if (shape === 'losange') {
        container.innerHTML = '<label>Large Diagonal (D):</label><input type="number" id="losange_D" step="any" />' +
                              '<label>Small Diagonal (d):</label><input type="number" id="losange_d" step="any" />';
      }
    });

    function compute2D() {
      const shape = document.getElementById('select2D').value;
      const resultDiv = document.getElementById('result2D');
      let html = ""; // We'll store HTML content here

      if (shape === 'carre') {
        const c = parseFloat(document.getElementById('carre_c').value);
        if (isNaN(c) || c <= 0) {
          html = "Invalid side.";
        } else {
          let A = c * c;
          let P = 4 * c;
          // Step-by-step with MathJax
          html = `
            <h3>Square</h3>
            <div class="step-title">Variables:</div>
            <p>\\( c = ${fmt(c)} \\)</p>
            <div class="step-title">Area Formula:</div>
            <p class="formula">\\( A = c^2 \\)</p>
            <p>Filled in: \\( A = (${fmt(c)})^2 = ${fmt(A)} \\)</p>
            <div class="step-title">Perimeter Formula:</div>
            <p class="formula">\\( P = 4c \\)</p>
            <p>Filled in: \\( P = 4 \\times ${fmt(c)} = ${fmt(P)} \\)</p>
          `;
        }
      }
      else if (shape === 'rectangle') {
        // You can similarly do a step-by-step approach
        const L = parseFloat(document.getElementById('rectangle_L').value);
        const l = parseFloat(document.getElementById('rectangle_l').value);
        if (isNaN(L) || L <= 0 || isNaN(l) || l <= 0) {
          html = "Invalid rectangle dimensions.";
        } else {
          let A = L * l;
          let P = 2*(L + l);
          html = `
            <h3>Rectangle</h3>
            <div class="step-title">Variables:</div>
            <p>\\( L = ${fmt(L)} \\), \\( l = ${fmt(l)} \\)</p>
            <div class="step-title">Area:</div>
            <p class="formula">\\( A = L \\times l \\)</p>
            <p>Filled in: \\( A = ${fmt(L)} \\times ${fmt(l)} = ${fmt(A)} \\)</p>
            <div class="step-title">Perimeter:</div>
            <p class="formula">\\( P = 2(L + l) \\)</p>
            <p>Filled in: \\( P = 2\\bigl(${fmt(L)} + ${fmt(l)}\\bigr) = ${fmt(P)} \\)</p>
          `;
        }
      }
      // ... etc. for circle, polygon, trapeze, rhombus ...

      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      // Trigger MathJax re-render:
      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    }

    //================================================
    // 2) 3D SOLIDS
    //================================================
    document.getElementById('select3D').addEventListener('change', function() {
      const solid = this.value;
      const container = document.getElementById('inputs3D');
      container.innerHTML = '';

      if (solid === 'prisme') {
        // let user pick a 2D base + a height
        container.innerHTML = `
          <p>For Prism, choose a base shape:</p>
          <select id="prismeBase">
            <option value="">--Select Base--</option>
            <option value="carre">Square</option>
            <option value="rectangle">Rectangle</option>
            <option value="cercle">Circle</option>
            <option value="polygone">Regular Polygon</option>
            <option value="trapeze">Trapeze</option>
            <option value="losange">Rhombus</option>
          </select>
          <div id="prismeBaseInputs"></div>
          <label>Height (h):</label>
          <input type="number" id="prisme_h" step="any" />
        `;
        document.getElementById('prismeBase').addEventListener('change', function() {
          const base = this.value;
          const baseContainer = document.getElementById('prismeBaseInputs');
          baseContainer.innerHTML = '';

          // Repeat logic for each base type...
          if (base === 'carre') {
            baseContainer.innerHTML = '<label>Side (c):</label><input type="number" id="prisme_carre_c" step="any" />';
          }
          else if (base === 'rectangle') {
            baseContainer.innerHTML = '<label>Length (L):</label><input type="number" id="prisme_rect_L" step="any" />' +
                                      '<label>Width (l):</label><input type="number" id="prisme_rect_l" step="any" />';
          }
          // etc...
        });
      }
      else if (solid === 'cube') {
        container.innerHTML = '<label>Edge (c):</label><input type="number" id="cube_c" step="any" />';
      }
      else if (solid === 'conePyramide') {
        container.innerHTML = `
          <p>For Cone/Pyramid, choose a base shape:</p>
          <select id="coneBase">
            <option value="">--Select Base--</option>
            <option value="cercle">Circle (Cone)</option>
            <option value="carre">Square (Pyramid)</option>
            <option value="rectangle">Rectangle (Pyramid)</option>
            <option value="polygone">Regular Polygon (Pyramid)</option>
          </select>
          <div id="coneBaseInputs"></div>
          <label>Height (h):</label>
          <input type="number" id="cone_h" step="any" />
        `;
        document.getElementById('coneBase').addEventListener('change', function() {
          const base = this.value;
          const baseContainer = document.getElementById('coneBaseInputs');
          baseContainer.innerHTML = '';

          if (base === 'cercle') {
            baseContainer.innerHTML = '<label>Radius (r):</label><input type="number" id="cone_cercle_r" step="any" />';
          }
          else if (base === 'carre') {
            baseContainer.innerHTML = '<label>Side (c):</label><input type="number" id="cone_carre_c" step="any" />';
          }
          // etc...
        });
      }
      else if (solid === 'sphere') {
        container.innerHTML = '<label>Radius (r):</label><input type="number" id="sphere_r" step="any" />';
      }
      else if (solid === 'cylindre') {
        container.innerHTML = '<label>Radius (r):</label><input type="number" id="cyl_r" step="any" />' +
                              '<label>Height (h):</label><input type="number" id="cyl_h" step="any" />';
      }
    });

    function compute3D() {
      const solid = document.getElementById('select3D').value;
      const resultDiv = document.getElementById('result3D');
      let html = "";

      // Example: "Cube" with a refined step-by-step approach
      if (solid === 'cube') {
        const c = parseFloat(document.getElementById('cube_c').value);
        if (isNaN(c) || c <= 0) {
          html = "Invalid cube edge.";
        } else {
          const A_lat = 4 * c * c;
          const A_tot = 6 * c * c;
          const V = c * c * c;
          html = `
            <h3>Cube Calculation</h3>
            <div class="step-title">Variables:</div>
            <p>\\( c = ${fmt(c)} \\)</p>

            <div class="step-title">Lateral Area</div>
            <p class="formula">\\( A_{lat} = 4c^2 \\)</p>
            <p>Filled in: \\( A_{lat} = 4 \\times (${fmt(c)})^2 = ${fmt(A_lat)} \\)</p>

            <div class="step-title">Total Surface Area</div>
            <p class="formula">\\( A_{tot} = 6c^2 \\)</p>
            <p>Filled in: \\( A_{tot} = 6 \\times (${fmt(c)})^2 = ${fmt(A_tot)} \\)</p>

            <div class="step-title">Volume</div>
            <p class="formula">\\( V = c^3 \\)</p>
            <p>Filled in: \\( V = (${fmt(c)})^3 = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid === 'sphere') {
        const r = parseFloat(document.getElementById('sphere_r').value);
        if (isNaN(r) || r <= 0) {
          html = "Invalid sphere radius.";
        } else {
          const A = 4 * Math.PI * r * r;
          const V = (4 / 3) * Math.PI * r * r * r;
          html = `
            <h3>Sphere Calculation</h3>
            <div class="step-title">Variables:</div>
            <p>\\( r = ${fmt(r)} \\)</p>

            <div class="step-title">Surface Area</div>
            <p class="formula">\\( A = 4\\pi r^2 \\)</p>
            <p>Filled in: \\( A = 4\\pi \\times (${fmt(r)})^2 = ${fmt(A)} \\)</p>

            <div class="step-title">Volume</div>
            <p class="formula">\\( V = \\frac{4}{3}\\pi r^3 \\)</p>
            <p>Filled in: \\( V = \\frac{4}{3}\\pi \\times (${fmt(r)})^3 = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid === 'cylindre') {
        const r = parseFloat(document.getElementById('cyl_r').value);
        const h = parseFloat(document.getElementById('cyl_h').value);
        if (isNaN(r) || r <= 0 || isNaN(h) || h <= 0) {
          html = "Invalid cylinder dimensions.";
        } else {
          const A_lat = 2 * Math.PI * r * h;
          const A_tot = A_lat + 2 * Math.PI * r * r;
          const V = Math.PI * r * r * h;
          html = `
            <h3>Cylinder Calculation</h3>
            <div class="step-title">Variables:</div>
            <p>\\( r = ${fmt(r)},\\ h = ${fmt(h)} \\)</p>

            <div class="step-title">Lateral Area</div>
            <p class="formula">\\( A_{lat} = 2\\pi r h \\)</p>
            <p>Filled in: \\( A_{lat} = 2\\pi \\times ${fmt(r)} \\times ${fmt(h)} = ${fmt(A_lat)} \\)</p>

            <div class="step-title">Total Surface Area</div>
            <p class="formula">\\( A_{tot} = A_{lat} + 2\\pi r^2 \\)</p>
            <p>Filled in: \\( A_{tot} = ${fmt(A_lat)} + 2\\pi \\times (${fmt(r)})^2 = ${fmt(A_tot)} \\)</p>

            <div class="step-title">Volume</div>
            <p class="formula">\\( V = \\pi r^2 h \\)</p>
            <p>Filled in: \\( V = \\pi \\times (${fmt(r)})^2 \\times ${fmt(h)} = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid === 'conePyramide') {
        const h = parseFloat(document.getElementById('cone_h').value);
        const baseType = document.getElementById('coneBase').value;
        if (isNaN(h) || h <= 0 || !baseType) {
          html = "Invalid cone/pyramid input.";
        } else {
          if (baseType === 'cercle') {
            // Cone
            const r = parseFloat(document.getElementById('cone_cercle_r').value);
            if (isNaN(r) || r <= 0) {
              html = "Invalid cone radius.";
            } else {
              const g = Math.sqrt(r*r + h*h);
              const A_lat = Math.PI * r * g;
              const A_base = Math.PI * r * r;
              const A_tot = A_lat + A_base;
              const V = (1/3) * Math.PI * r * r * h;
              html = `
                <h3>Cone (Circular Base)</h3>
                <div class="step-title">Variables:</div>
                <p>\\( r = ${fmt(r)},\\ h = ${fmt(h)} \\)</p>

                <div class="step-title">Slant Height</div>
                <p class="formula">\\( g = \\sqrt{r^2 + h^2} \\)</p>
                <p>\\( g = \\sqrt{(${fmt(r)})^2 + (${fmt(h)})^2} = ${fmt(g)} \\)</p>

                <div class="step-title">Lateral Area</div>
                <p class="formula">\\( A_{lat} = \\pi r g \\)</p>
                <p>\\( A_{lat} = \\pi \\times ${fmt(r)} \\times ${fmt(g)} = ${fmt(A_lat)} \\)</p>

                <div class="step-title">Base Area</div>
                <p class="formula">\\( A_{base} = \\pi r^2 \\)</p>
                <p>\\( A_{base} = \\pi \\times (${fmt(r)})^2 = ${fmt(A_base)} \\)</p>

                <div class="step-title">Total Surface Area</div>
                <p class="formula">\\( A_{tot} = A_{lat} + A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + ${fmt(A_base)} = ${fmt(A_tot)} \\)</p>

                <div class="step-title">Volume</div>
                <p class="formula">\\( V = \\frac{1}{3}\\pi r^2 h \\)</p>
                <p>\\( V = \\frac{1}{3}\\pi \\times (${fmt(r)})^2 \\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
          // Similarly do a step-by-step approach for Square pyramid, Rectangle pyramid, etc.
          else if (baseType === 'carre') {
            // example
          }
        }
      }
      // else if (solid === 'prisme') { ... }  <--- you can add step-by-step similarly

      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      // Trigger MathJax re-render
      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    }

    //================================================
    // 3) MEASURES FROM A SPECIFIC AREA
    //================================================
    function computeMeasuresArea() {
      const area = parseFloat(document.getElementById('inputArea').value);
      const solid = document.getElementById('selectSolidArea').value;
      let result = `<h3>For area = ${fmt(area)} (u²)</h3>`;
      if (!solid || isNaN(area) || area <= 0) {
        result = "Invalid input.";
      } else {
        if (solid === 'sphere') {
          const r = Math.sqrt(area / (4 * Math.PI));
          result += `<p>Sphere radius = ${fmt(r)}</p>`;
        }
        else if (solid === 'cone') {
          result += "<p>Possible cones (looping over r)...</p>";
          for (let r = 1.0; r <= Math.sqrt(area); r += 0.1) {
            let g = (area - Math.PI * r * r) / (Math.PI * r);
            if (g > 0) {
              let h = Math.sqrt(g*g - r*r);
              if (g > 0 && validThousandths(g) && r/g>0.3 && h/g>0.4) {
                result += `Cone: r=${fmt(r)}, h=${fmt(h)}, g=${fmt(g)}<br>`;
              }
            }
          }
        }
        // etc. for cylinder, cube, prism, pyramid ...
      }
      const div = document.getElementById('resultArea');
      div.innerHTML = result;
      div.style.display = 'block';
      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    }

    //================================================
    // 4) MEASURES FROM A SPECIFIC VOLUME
    //================================================
    function computeMeasuresVolume() {
      const volume = parseFloat(document.getElementById('inputVolume').value);
      const solid = document.getElementById('selectSolidVolume').value;
      let result = `<h3>For volume = ${fmt(volume)} (u³)</h3>`;
      if (!solid || isNaN(volume) || volume <= 0) {
        result = "Invalid input.";
      } else {
        if (solid === 'sphere') {
          const r = Math.cbrt((3*volume)/(4*Math.PI));
          result += `<p>Sphere radius = ${fmt(r)}</p>`;
        }
        else if (solid === 'cone') {
          result += "<p>Possible cones (looping over r)...</p>";
          for (let r=0.5; r<=Math.cbrt(volume); r+=0.1) {
            let h = (3*volume)/(Math.PI*r*r);
            let g = Math.sqrt(r*r + h*h);
            if (g>0 && validThousandths(g)) {
              result += `Cone: r=${fmt(r)}, h=${fmt(h)}, g=${fmt(g)}<br>`;
            }
          }
        }
        // etc. for cylinder, cube, prism, pyramid ...
      }
      const div = document.getElementById('resultVolume');
      div.innerHTML = result;
      div.style.display = 'block';
      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    }
  </script>
</body>
</html>
