<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3Db - Geometry Calculator</title>
  <!-- MathJax for professional math rendering -->
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1em;
      text-align: center;
    }
    .lang-container {
      text-align: right;
      margin: 10px;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    h2 { margin-top: 0; }
    .menu button, .section button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 1.1em;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      box-sizing: border-box;
      font-size: 1em;
    }
    .back-btn {
      margin-top: 20px;
    }
    .result {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-left: 4px solid #0066cc;
      white-space: normal;
      font-size: 1.1em;
    }
    .formula {
      background: #fff;
      padding: 10px;
      margin: 5px 0;
      font-family: serif;
      font-size: 1.15em;
    }
    .step-title {
      font-weight: bold;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="headerTitle">3Db Geometry Calculator</h1>
  </header>

  <div class="lang-container">
    <label id="langLabel" for="languageSelect">Language / Langue:</label>
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="fr">Français</option>
    </select>
  </div>

  <div class="container">
    <!-- Main Menu -->
    <div id="mainMenu" class="menu">
      <h2 id="mainMenuTitle">Main Menu</h2>
      <button id="btn2D" onclick="showSection('2D')">1. 2D Shapes (Area & Perimeter)</button>
      <button id="btn3D" onclick="showSection('3D')">2. 3D Solids</button>
      <button id="btnMeasureArea" onclick="showSection('measureArea')">3. Measures from a Specific Area</button>
      <button id="btnMeasureVolume" onclick="showSection('measureVolume')">4. Measures from a Specific Volume</button>
      <button id="btnQuit" onclick="exitProgram()">5. Quit</button>
    </div>

    <!-- 2D Shapes Section -->
    <div id="section2D" class="section" style="display:none;">
      <h2 id="section2DTitle">2D Shapes</h2>
      <p id="pSelect2D">Select a shape:</p>
      <select id="select2D">
        <option value=""></option>
        <option value="carre">Square (Carre)</option>
        <option value="rectangle">Rectangle</option>
        <option value="cercle">Circle (Cercle)</option>
        <option value="polygone">Regular Polygon (Polygone regulier)</option>
        <option value="trapeze">Isosceles Trapeze</option>
        <option value="losange">Rhombus</option>
      </select>
      <div id="inputs2D"></div>
      <button id="btnCompute2D" onclick="compute2D()">Compute</button>
      <div id="result2D" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()"></button>
    </div>

    <!-- 3D Solids Section -->
    <div id="section3D" class="section" style="display:none;">
      <h2 id="section3DTitle">3D Solids</h2>
      <p id="pSelect3D">Select a solid:</p>
      <select id="select3D">
        <option value=""></option>
        <option value="prisme">Prism</option>
        <option value="cube">Cube</option>
        <option value="conePyramide">Cone/Pyramid</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
      </select>
      <div id="inputs3D"></div>
      <button id="btnCompute3D" onclick="compute3D()">Compute</button>
      <div id="result3D" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()"></button>
    </div>

    <!-- Measures from a Specific Area Section -->
    <div id="sectionMeasureArea" class="section" style="display:none;">
      <h2 id="sectionMeasureAreaTitle">Measures from a Specific Area</h2>
      <p id="pInputArea">Enter desired area (in u²):</p>
      <input type="number" id="inputArea" step="any" />
      <p id="pSelectSolidArea">Select a solid type:</p>
      <select id="selectSolidArea">
        <option value=""></option>
        <option value="cone">Cone</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
        <option value="cube">Cube</option>
        <option value="prisme">Prism (square base)</option>
        <option value="pyramide">Pyramid (square base)</option>
      </select>
      <button id="btnComputeMeasureArea" onclick="computeMeasuresArea()">Find Dimensions</button>
      <div id="resultArea" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()"></button>
    </div>

    <!-- Measures from a Specific Volume Section -->
    <div id="sectionMeasureVolume" class="section" style="display:none;">
      <h2 id="sectionMeasureVolumeTitle">Measures from a Specific Volume</h2>
      <p id="pInputVolume">Enter desired volume (in u³):</p>
      <input type="number" id="inputVolume" step="any" />
      <p id="pSelectSolidVolume">Select a solid type:</p>
      <select id="selectSolidVolume">
        <option value=""></option>
        <option value="cone">Cone</option>
        <option value="sphere">Sphere</option>
        <option value="cylindre">Cylinder</option>
        <option value="cube">Cube</option>
        <option value="prisme">Prism (square base)</option>
        <option value="pyramide">Pyramid (square base)</option>
      </select>
      <button id="btnComputeMeasureVolume" onclick="computeMeasuresVolume()">Find Dimensions</button>
      <div id="resultVolume" class="result" style="display:none;"></div>
      <button class="back-btn" onclick="backToMain()"></button>
    </div>
  </div>

  <script>
    // ============================================================
    // LANGUAGE DICTIONARIES
    // ============================================================
    const dictEN = {
      "mainMenuTitle": "Main Menu",
      "btn2D": "1. 2D Shapes (Area & Perimeter)",
      "btn3D": "2. 3D Solids",
      "btnMeasureArea": "3. Measures from a Specific Area",
      "btnMeasureVolume": "4. Measures from a Specific Volume",
      "btnQuit": "5. Quit",
      "section2DTitle": "2D Shapes",
      "pSelect2D": "Select a shape:",
      "optionSelect": "--Select--",
      "carre": "Square (Carre)",
      "rectangle": "Rectangle",
      "cercle": "Circle (Cercle)",
      "polygone": "Regular Polygon",
      "trapeze": "Isosceles Trapeze",
      "losange": "Rhombus",
      "section3DTitle": "3D Solids",
      "pSelect3D": "Select a solid:",
      "prisme": "Prism",
      "cube": "Cube",
      "conePyramide": "Cone/Pyramid",
      "sphere": "Sphere",
      "cylindre": "Cylinder",
      "coneBaseTitle": "Base shape for Cone/Pyramid:",
      "optionCercle": "Circle (Cone)",
      "optionCarre": "Square (Pyramid)",
      "optionRectangle": "Rectangle (Pyramid)",
      "optionNgon": "n-gon (Pyramid)",
      "sectionMeasureAreaTitle": "Measures from a Specific Area",
      "pInputArea": "Enter desired area (in u²):",
      "pSelectSolidArea": "Select a solid type:",
      "sectionMeasureVolumeTitle": "Measures from a Specific Volume",
      "pInputVolume": "Enter desired volume (in u³):",
      "pSelectSolidVolume": "Select a solid type:",
      "variables": "Variables",
      "lateralArea": "Lateral Area",
      "baseArea": "Base Area",
      "totalArea": "Total Surface Area",
      "volume": "Volume",
      "generatrix": "Slant Height",
      "radius": "Radius",
      "height": "Height",
      "side": "Side",
      "length": "Length",
      "width": "Width",
      "cubeTitle": "Cube Calculation",
      "sphereTitle": "Sphere Calculation",
      "cylTitle": "Cylinder Calculation",
      "coneTitle": "Cone (Circular Base)",
      "pyramidSqTitle": "Pyramid (Square Base)",
      "pyramidRectTitle": "Pyramid (Rectangular Base)",
      "pyramidNgonTitle": "Pyramid (n-gon Base)",
      "prismRectTitle": "Prism (Rectangular Base)",
      "back": "Back"
    };

    const dictFR = {
      "mainMenuTitle": "Menu Principal",
      "btn2D": "1. Formes 2D (Aire et Périmètre)",
      "btn3D": "2. Solides 3D",
      "btnMeasureArea": "3. Mesures à partir d'une Aire Spécifique",
      "btnMeasureVolume": "4. Mesures à partir d'un Volume Spécifique",
      "btnQuit": "5. Quitter",
      "section2DTitle": "Formes 2D",
      "pSelect2D": "Sélectionnez une forme :",
      "optionSelect": "--Sélectionnez--",
      "carre": "Carré",
      "rectangle": "Rectangle",
      "cercle": "Cercle",
      "polygone": "Polygone Régulier",
      "trapeze": "Trapèze Isocèle",
      "losange": "Losange",
      "section3DTitle": "Solides 3D",
      "pSelect3D": "Sélectionnez un solide :",
      "prisme": "Prisme",
      "cube": "Cube",
      "conePyramide": "Cône/Pyramide",
      "sphere": "Sphère",
      "cylindre": "Cylindre",
      "coneBaseTitle": "Forme de la base pour Cône/Pyramide :",
      "optionCercle": "Cercle (Cône)",
      "optionCarre": "Carré (Pyramide)",
      "optionRectangle": "Rectangle (Pyramide)",
      "optionNgon": "Polygone à n côtés (Pyramide)",
      "sectionMeasureAreaTitle": "Mesures à partir d'une Aire Spécifique",
      "pInputArea": "Entrez l'aire désirée (en u²) :",
      "pSelectSolidArea": "Sélectionnez un solide :",
      "sectionMeasureVolumeTitle": "Mesures à partir d'un Volume Spécifique",
      "pInputVolume": "Entrez le volume désiré (en u³) :",
      "pSelectSolidVolume": "Sélectionnez un solide :",
      "variables": "Variables",
      "lateralArea": "Aire latérale",
      "baseArea": "Aire de base",
      "totalArea": "Aire totale",
      "volume": "Volume",
      "generatrix": "Génératrice",
      "radius": "Rayon",
      "height": "Hauteur",
      "side": "Côté",
      "length": "Longueur",
      "width": "Largeur",
      "cubeTitle": "Calcul du Cube",
      "sphereTitle": "Calcul de la Sphère",
      "cylTitle": "Calcul du Cylindre",
      "coneTitle": "Cône (Base Circulaire)",
      "pyramidSqTitle": "Pyramide (Base Carrée)",
      "pyramidRectTitle": "Pyramide (Base Rectangulaire)",
      "pyramidNgonTitle": "Pyramide (Base à n côtés)",
      "prismRectTitle": "Prisme (Base Rectangulaire)",
      "back": "Retour"
    };

    let currentLang = "en";
    function T(key) {
      return currentLang === "fr" ? (dictFR[key] || key) : (dictEN[key] || key);
    }

    // Update all static UI texts
    function updateUITexts() {
      document.getElementById("headerTitle").innerText = T("mainMenuTitle");
      document.getElementById("mainMenuTitle").innerText = T("mainMenuTitle");
      document.getElementById("btn2D").innerText = T("btn2D");
      document.getElementById("btn3D").innerText = T("btn3D");
      document.getElementById("btnMeasureArea").innerText = T("btnMeasureArea");
      document.getElementById("btnMeasureVolume").innerText = T("btnMeasureVolume");
      document.getElementById("btnQuit").innerText = T("btnQuit");

      document.getElementById("section2DTitle").innerText = T("section2DTitle");
      document.getElementById("pSelect2D").innerText = T("pSelect2D");
      document.querySelector("#select2D option[value='']").textContent = T("optionSelect");

      document.getElementById("section3DTitle").innerText = T("section3DTitle");
      document.getElementById("pSelect3D").innerText = T("pSelect3D");
      document.querySelector("#select3D option[value='']").textContent = T("optionSelect");

      document.getElementById("sectionMeasureAreaTitle").innerText = T("sectionMeasureAreaTitle");
      document.getElementById("pInputArea").innerText = T("pInputArea");
      document.getElementById("pSelectSolidArea").innerText = T("pSelectSolidArea");
      document.querySelector("#selectSolidArea option[value='']").textContent = T("optionSelect");

      document.getElementById("sectionMeasureVolumeTitle").innerText = T("sectionMeasureVolumeTitle");
      document.getElementById("pInputVolume").innerText = T("pInputVolume");
      document.getElementById("pSelectSolidVolume").innerText = T("pSelectSolidVolume");
      document.querySelector("#selectSolidVolume option[value='']").textContent = T("optionSelect");

      // Also update back buttons
      let backButtons = document.getElementsByClassName("back-btn");
      for(let btn of backButtons) {
        btn.innerText = T("back");
      }
    }

    // Language selector event
    document.getElementById("languageSelect").addEventListener("change", function() {
      currentLang = this.value;
      updateUITexts();
    });
    updateUITexts();

    // ============================================================
    // 2D Shapes (Square and Rectangle only for brevity)
    // ============================================================
    document.getElementById('select2D').addEventListener('change', function() {
      const shape = this.value;
      const container = document.getElementById('inputs2D');
      container.innerHTML = '';
      if (shape==='carre') {
        container.innerHTML = `<label>${currentLang==="fr"?"Côté (c):":"Side (c):"}</label><input type="number" id="carre_c" step="any" />`;
      } else if (shape==='rectangle') {
        container.innerHTML = `<label>${T("length")} (L):</label><input type="number" id="rectangle_L" step="any" />` +
                              `<label>${T("width")} (l):</label><input type="number" id="rectangle_l" step="any" />`;
      }
    });

    function compute2D() {
      const shape = document.getElementById('select2D').value;
      const resultDiv = document.getElementById('result2D');
      let html = "";
      if (!shape) {
        html = currentLang==="fr"?"Aucune forme sélectionnée.":"No shape selected.";
      }
      else if (shape==='carre') {
        const c = parseFloat(document.getElementById('carre_c').value);
        if (isNaN(c) || c<=0) {
          html = currentLang==="fr"?"Côté invalide.":"Invalid side.";
        } else {
          let A = c*c;
          let P = 4*c;
          html = `
            <h3>${currentLang==="fr"?"Carré":"Square"}</h3>
            <div class="step-title">${T("variables")}:</div>
            <p>\\( c = ${fmt(c)} \\)</p>
            <div class="step-title">${currentLang==="fr"?"Aire":"Area"}:</div>
            <p class="formula">\\( A = c^2 \\)</p>
            <p>\\( A = (${fmt(c)})^2 = ${fmt(A)} \\)</p>
            <div class="step-title">${currentLang==="fr"?"Périmètre":"Perimeter"}:</div>
            <p class="formula">\\( P = 4c \\)</p>
            <p>\\( P = 4 \\times ${fmt(c)} = ${fmt(P)} \\)</p>
          `;
        }
      }
      else if (shape==='rectangle') {
        const L = parseFloat(document.getElementById('rectangle_L').value);
        const l = parseFloat(document.getElementById('rectangle_l').value);
        if (isNaN(L) || L<=0 || isNaN(l) || l<=0) {
          html = currentLang==="fr"?"Dimensions du rectangle invalides.":"Invalid rectangle dimensions.";
        } else {
          let A = L*l;
          let P = 2*(L+l);
          html = `
            <h3>${currentLang==="fr"?"Rectangle":"Rectangle"}</h3>
            <div class="step-title">${T("variables")}:</div>
            <p>\\( L = ${fmt(L)},\\ l = ${fmt(l)} \\)</p>
            <div class="step-title">${currentLang==="fr"?"Aire":"Area"}:</div>
            <p class="formula">\\( A = L\\times l \\)</p>
            <p>\\( A = ${fmt(L)}\\times ${fmt(l)} = ${fmt(A)} \\)</p>
            <div class="step-title">${currentLang==="fr"?"Périmètre":"Perimeter"}:</div>
            <p class="formula">\\( P = 2(L+l) \\)</p>
            <p>\\( P = 2\\times (${fmt(L)}+${fmt(l)}) = ${fmt(P)} \\)</p>
          `;
        }
      }
      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      if (window.MathJax) { MathJax.typesetPromise(); }
    }

    // ============================================================
    // 3D Solids Section
    // ============================================================
    document.getElementById('select3D').addEventListener('change', function() {
      const solid = this.value;
      const container = document.getElementById('inputs3D');
      container.innerHTML = '';
      if (solid==='prisme') {
        container.innerHTML = `
          <p>${currentLang==="fr"?"Sélectionnez la forme de base :":"Select base shape:"}</p>
          <select id="prismeBase">
            <option value=""></option>
            <option value="carre">${T("carre")}</option>
            <option value="rectangle">${T("rectangle")}</option>
          </select>
          <div id="prismeBaseInputs"></div>
          <label>${T("height")} (h):</label>
          <input type="number" id="prisme_h" step="any" />
        `;
        document.getElementById('prismeBase').addEventListener('change', function(){
          const base = this.value;
          const baseContainer = document.getElementById('prismeBaseInputs');
          baseContainer.innerHTML = '';
          if (base==='carre') {
            baseContainer.innerHTML = `<label>${currentLang==="fr"?"Côté (c):":"Side (c):"}</label><input type="number" id="prisme_carre_c" step="any" />`;
          }
          else if (base==='rectangle') {
            baseContainer.innerHTML = `<label>${T("length")} (L):</label><input type="number" id="prisme_rect_L" step="any" />` +
                                      `<label>${T("width")} (l):</label><input type="number" id="prisme_rect_l" step="any" />`;
          }
        });
      }
      else if (solid==='cube') {
        container.innerHTML = `<label>${T("side")} (c):</label><input type="number" id="cube_c" step="any" />`;
      }
      else if (solid==='conePyramide') {
        container.innerHTML = `
          <p>${T("coneBaseTitle")}</p>
          <select id="coneBase">
            <option value=""></option>
            <option value="cercle">${T("optionCercle")}</option>
            <option value="carre">${T("optionCarre")}</option>
            <option value="rectangle">${T("optionRectangle")}</option>
            <option value="ngon">${T("optionNgon")}</option>
          </select>
          <div id="coneBaseInputs"></div>
          <label>${T("height")} (h):</label>
          <input type="number" id="cone_h" step="any" />
        `;
        document.getElementById('coneBase').addEventListener('change', function(){
          const base = this.value;
          const baseContainer = document.getElementById('coneBaseInputs');
          baseContainer.innerHTML = '';
          if (base==='cercle') {
            baseContainer.innerHTML = `<label>${T("radius")} (r):</label><input type="number" id="cone_cercle_r" step="any" />`;
          }
          else if (base==='carre') {
            baseContainer.innerHTML = `<label>${T("side")} (c):</label><input type="number" id="cone_carre_c" step="any" />`;
          }
          else if (base==='rectangle') {
            baseContainer.innerHTML = `<label>${T("length")} (L):</label><input type="number" id="cone_rect_L" step="any" />` +
                                      `<label>${T("width")} (l):</label><input type="number" id="cone_rect_l" step="any" />`;
          }
          else if (base==='ngon') {
            baseContainer.innerHTML = `<label>n :</label><input type="number" id="cone_ngon_n" step="1" />` +
                                      `<label>${T("side")} (s):</label><input type="number" id="cone_ngon_s" step="any" />`;
          }
        });
      }
      else if (solid==='sphere') {
        container.innerHTML = `<label>${T("radius")} (r):</label><input type="number" id="sphere_r" step="any" />`;
      }
      else if (solid==='cylindre') {
        container.innerHTML = `<label>${T("radius")} (r):</label><input type="number" id="cyl_r" step="any" />` +
                              `<label>${T("height")} (h):</label><input type="number" id="cyl_h" step="any" />`;
      }
    });

    function compute3D() {
      const solid = document.getElementById('select3D').value;
      const resultDiv = document.getElementById('result3D');
      let html = "";
      if (!solid) {
        html = currentLang==="fr"?"Aucun solide sélectionné.":"No solid selected.";
      }
      else if (solid==='cube') {
        const c = parseFloat(document.getElementById('cube_c').value);
        if (isNaN(c) || c<=0) {
          html = currentLang==="fr"?"Côté invalide.":"Invalid cube edge.";
        } else {
          const A_lat = 4*c*c;
          const A_tot = 6*c*c;
          const V = c*c*c;
          html = `
            <h3>${T("cubeTitle")}</h3>
            <div class="step-title">${T("variables")}:</div>
            <p>\\( c = ${fmt(c)} \\)</p>
            <div class="step-title">${T("lateralArea")}:</div>
            <p class="formula">\\( A_{lat} = 4c^2 \\)</p>
            <p>\\( A_{lat} = 4 \\times (${fmt(c)})^2 = ${fmt(A_lat)} \\)</p>
            <div class="step-title">${T("totalArea")}:</div>
            <p class="formula">\\( A_{tot} = 6c^2 \\)</p>
            <p>\\( A_{tot} = 6 \\times (${fmt(c)})^2 = ${fmt(A_tot)} \\)</p>
            <div class="step-title">${T("volume")}:</div>
            <p class="formula">\\( V = c^3 \\)</p>
            <p>\\( V = (${fmt(c)})^3 = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid==='sphere') {
        const r = parseFloat(document.getElementById('sphere_r').value);
        if (isNaN(r) || r<=0) {
          html = currentLang==="fr"?"Rayon invalide.":"Invalid sphere radius.";
        } else {
          const A = 4*Math.PI*r*r;
          const V = (4/3)*Math.PI*r*r*r;
          html = `
            <h3>${T("sphereTitle")}</h3>
            <div class="step-title">${T("variables")}:</div>
            <p>\\( ${T("radius")} = ${fmt(r)} \\)</p>
            <div class="step-title">${T("totalArea")}:</div>
            <p class="formula">\\( A = 4\\pi r^2 \\)</p>
            <p>\\( A = 4\\pi \\times (${fmt(r)})^2 = ${fmt(A)} \\)</p>
            <div class="step-title">${T("volume")}:</div>
            <p class="formula">\\( V = \\frac{4}{3}\\pi r^3 \\)</p>
            <p>\\( V = \\frac{4}{3}\\pi \\times (${fmt(r)})^3 = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid==='cylindre') {
        const r = parseFloat(document.getElementById('cyl_r').value);
        const h = parseFloat(document.getElementById('cyl_h').value);
        if (isNaN(r) || r<=0 || isNaN(h) || h<=0) {
          html = currentLang==="fr"?"Dimensions du cylindre invalides.":"Invalid cylinder dimensions.";
        } else {
          const A_lat = 2*Math.PI*r*h;
          const A_tot = A_lat + 2*Math.PI*r*r;
          const V = Math.PI*r*r*h;
          html = `
            <h3>${T("cylTitle")}</h3>
            <div class="step-title">${T("variables")}:</div>
            <p>\\( ${T("radius")} = ${fmt(r)},\\ ${T("height")} = ${fmt(h)} \\)</p>
            <div class="step-title">${T("lateralArea")}:</div>
            <p class="formula">\\( A_{lat} = 2\\pi r h \\)</p>
            <p>\\( A_{lat} = 2\\pi \\times ${fmt(r)} \\times ${fmt(h)} = ${fmt(A_lat)} \\)</p>
            <div class="step-title">${T("totalArea")}:</div>
            <p class="formula">\\( A_{tot} = A_{lat} + 2\\pi r^2 \\)</p>
            <p>\\( A_{tot} = ${fmt(A_lat)} + 2\\pi \\times (${fmt(r)})^2 = ${fmt(A_tot)} \\)</p>
            <div class="step-title">${T("volume")}:</div>
            <p class="formula">\\( V = \\pi r^2 h \\)</p>
            <p>\\( V = \\pi \\times (${fmt(r)})^2 \\times ${fmt(h)} = ${fmt(V)} \\)</p>
          `;
        }
      }
      else if (solid==='conePyramide') {
        const h = parseFloat(document.getElementById('cone_h').value);
        const baseType = document.getElementById('coneBase').value;
        if (isNaN(h) || h<=0 || !baseType) {
          html = currentLang==="fr"?"Entrée invalide pour le Cône/Pyramide.":"Invalid cone/pyramid input.";
        } else {
          if (baseType==='cercle') {
            const r = parseFloat(document.getElementById('cone_cercle_r').value);
            if (isNaN(r) || r<=0) {
              html = currentLang==="fr"?"Rayon invalide pour le cône.":"Invalid cone radius.";
            } else {
              const g = Math.sqrt(r*r + h*h);
              const A_lat = Math.PI*r*g;
              const A_base = Math.PI*r*r;
              const A_tot = A_lat + A_base;
              const V = (1/3)*Math.PI*r*r*h;
              html = `
                <h3>${T("coneTitle")}</h3>
                <div class="step-title">${T("variables")}:</div>
                <p>\\( ${T("radius")} = ${fmt(r)},\\ ${T("height")} = ${fmt(h)} \\)</p>
                <div class="step-title">${T("generatrix")}:</div>
                <p class="formula">\\( g = \\sqrt{r^2 + h^2} \\)</p>
                <p>\\( g = \\sqrt{(${fmt(r)})^2 + (${fmt(h)})^2} = ${fmt(g)} \\)</p>
                <div class="step-title">${T("lateralArea")}:</div>
                <p class="formula">\\( A_{lat} = \\pi r g \\)</p>
                <p>\\( A_{lat} = \\pi \\times ${fmt(r)} \\times ${fmt(g)} = ${fmt(A_lat)} \\)</p>
                <div class="step-title">${T("baseArea")}:</div>
                <p class="formula">\\( A_{base} = \\pi r^2 \\)</p>
                <p>\\( A_{base} = \\pi \\times (${fmt(r)})^2 = ${fmt(A_base)} \\)</p>
                <div class="step-title">${T("totalArea")}:</div>
                <p class="formula">\\( A_{tot} = A_{lat} + A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + ${fmt(A_base)} = ${fmt(A_tot)} \\)</p>
                <div class="step-title">${T("volume")}:</div>
                <p class="formula">\\( V = \\frac{1}{3}\\pi r^2 h \\)</p>
                <p>\\( V = \\frac{1}{3}\\pi \\times (${fmt(r)})^2 \\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
          else if (baseType==='carre') {
            const c = parseFloat(document.getElementById('cone_carre_c').value);
            if (isNaN(c) || c<=0) {
              html = currentLang==="fr"?"Côté invalide pour la base carrée.":"Invalid square base side.";
            } else {
              const baseArea = c*c;
              const basePerim = 4*c;
              const aBase = c/2;
              const g = Math.sqrt(h*h + aBase*aBase);
              const A_lat = (basePerim*g)/2;
              const A_tot = A_lat + baseArea;
              const V = (1/3)*baseArea*h;
              html = `
                <h3>${T("pyramidSqTitle")}</h3>
                <div class="step-title">${T("variables")}:</div>
                <p>\\( c = ${fmt(c)},\\ h = ${fmt(h)} \\)</p>
                <div class="step-title">Computed:</div>
                <p>\\( A_{base} = c^2 = ${fmt(baseArea)} \\)</p>
                <p>\\( P_{base} = 4c = ${fmt(basePerim)} \\)</p>
                <p>\\( a = c/2 = ${fmt(aBase)} \\)</p>
                <p class="formula">\\( g = \\sqrt{h^2 + a^2} \\)</p>
                <p>\\( g = \\sqrt{(${fmt(h)})^2 + (${fmt(aBase)})^2} = ${fmt(g)} \\)</p>
                <div class="step-title">${T("lateralArea")}:</div>
                <p class="formula">\\( A_{lat} = \\frac{P_{base}\\times g}{2} \\)</p>
                <p>\\( A_{lat} = \\frac{${fmt(basePerim)}\\times ${fmt(g)}}{2} = ${fmt(A_lat)} \\)</p>
                <div class="step-title">${T("totalArea")}:</div>
                <p class="formula">\\( A_{tot} = A_{lat} + A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + ${fmt(baseArea)} = ${fmt(A_tot)} \\)</p>
                <div class="step-title">${T("volume")}:</div>
                <p class="formula">\\( V = \\frac{1}{3} A_{base} h \\)</p>
                <p>\\( V = \\frac{1}{3}\\times ${fmt(baseArea)} \\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
          else if (baseType==='rectangle') {
            const L = parseFloat(document.getElementById('cone_rect_L').value);
            const l = parseFloat(document.getElementById('cone_rect_l').value);
            if(isNaN(L)||L<=0||isNaN(l)||l<=0) {
              html = currentLang==="fr"?"Dimensions de base rectangulaire invalides.":"Invalid rectangle base input.";
            } else {
              const baseArea = L * l;
              const basePerim = 2*(L+l);
              const aBase = Math.min(L, l)/2;
              const g = Math.sqrt(h*h + aBase*aBase);
              const A_lat = (basePerim*g)/2;
              const A_tot = A_lat + baseArea;
              const V = (1/3)*baseArea*h;
              html = `
                <h3>${T("pyramidRectTitle")}</h3>
                <div class="step-title">${T("variables")}:</div>
                <p>\\( L = ${fmt(L)},\\ l = ${fmt(l)},\\ h = ${fmt(h)} \\)</p>
                <div class="step-title">Computed:</div>
                <p class="formula">\\( A_{base} = L \\times l \\)</p>
                <p>\\( A_{base} = ${fmt(L)}\\times ${fmt(l)} = ${fmt(baseArea)} \\)</p>
                <p>\\( P_{base} = 2(L+l) = ${fmt(basePerim)} \\)</p>
                <p>\\( a = \\min(L,l)/2 = ${fmt(aBase)} \\)</p>
                <p class="formula">\\( g = \\sqrt{h^2 + a^2} \\)</p>
                <p>\\( g = \\sqrt{(${fmt(h)})^2 + (${fmt(aBase)})^2} = ${fmt(g)} \\)</p>
                <div class="step-title">${T("lateralArea")}:</div>
                <p class="formula">\\( A_{lat} = \\frac{P_{base}\\times g}{2} \\)</p>
                <p>\\( A_{lat} = \\frac{${fmt(basePerim)}\\times ${fmt(g)}}{2} = ${fmt(A_lat)} \\)</p>
                <div class="step-title">${T("totalArea")}:</div>
                <p class="formula">\\( A_{tot} = A_{lat} + A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + ${fmt(baseArea)} = ${fmt(A_tot)} \\)</p>
                <div class="step-title">${T("volume")}:</div>
                <p class="formula">\\( V = \\frac{1}{3}A_{base}h \\)</p>
                <p>\\( V = \\frac{1}{3}\\times ${fmt(baseArea)} \\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
          else if (baseType==='ngon') {
            const n = parseInt(document.getElementById('cone_ngon_n').value);
            const s = parseFloat(document.getElementById('cone_ngon_s').value);
            if (isNaN(n) || n < 3 || isNaN(s) || s <= 0) {
              html = currentLang==="fr"?"Entrée invalide pour la base en n côtés.":"Invalid n-gon base input.";
            } else {
              const baseArea = (n * s * s) / (4 * Math.tan(Math.PI/n));
              const basePerim = n * s;
              const aBase = s / (2 * Math.tan(Math.PI/n));
              const g = Math.sqrt(h*h + aBase*aBase);
              const A_lat = (basePerim * g) / 2;
              const A_tot = A_lat + baseArea;
              const V = (1/3)*baseArea*h;
              html = `
                <h3>${T("pyramidNgonTitle")}</h3>
                <div class="step-title">${T("variables")}:</div>
                <p>\\( n = ${n},\\ s = ${fmt(s)},\\ h = ${fmt(h)} \\)</p>
                <div class="step-title">Computed:</div>
                <p class="formula">\\( A_{base} = \\frac{n s^2}{4\\tan(\\pi/n)} \\)</p>
                <p>\\( A_{base} = \\frac{${n}\\times (${fmt(s)})^2}{4\\tan(\\pi/${n})} = ${fmt(baseArea)} \\)</p>
                <p>\\( P_{base} = n s = ${fmt(basePerim)} \\)</p>
                <p>\\( a = \\frac{s}{2\\tan(\\pi/n)} = ${fmt(aBase)} \\)</p>
                <p class="formula">\\( g = \\sqrt{h^2+a^2} \\)</p>
                <p>\\( g = \\sqrt{(${fmt(h)})^2+(${fmt(aBase)})^2} = ${fmt(g)} \\)</p>
                <div class="step-title">${T("lateralArea")}:</div>
                <p class="formula">\\( A_{lat} = \\frac{P_{base}\\times g}{2} \\)</p>
                <p>\\( A_{lat} = \\frac{${fmt(basePerim)}\\times ${fmt(g)}}{2} = ${fmt(A_lat)} \\)</p>
                <div class="step-title">${T("totalArea")}:</div>
                <p class="formula">\\( A_{tot} = A_{lat} + A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + ${fmt(baseArea)} = ${fmt(A_tot)} \\)</p>
                <div class="step-title">${T("volume")}:</div>
                <p class="formula">\\( V = \\frac{1}{3}A_{base}h \\)</p>
                <p>\\( V = \\frac{1}{3}\\times ${fmt(baseArea)} \\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
        }
      }
      else if (solid==='prisme') {
        const baseChoice = document.getElementById('prismeBase').value;
        const h = parseFloat(document.getElementById('prisme_h').value);
        if (isNaN(h)||h<=0 || !baseChoice) {
          html = currentLang==="fr"?"Entrée invalide pour le prisme.":"Invalid prism input.";
        } else {
          if (baseChoice==='rectangle') {
            const L = parseFloat(document.getElementById('prisme_rect_L').value);
            const l = parseFloat(document.getElementById('prisme_rect_l').value);
            if (isNaN(L)||L<=0||isNaN(l)||l<=0) {
              html = currentLang==="fr"?"Base rectangulaire invalide.":"Invalid rectangle base.";
            } else {
              const baseA = L*l;
              const baseP = 2*(L+l);
              const A_lat = baseP*h;
              const A_tot = A_lat + 2*baseA;
              const V = baseA*h;
              html = `
                <h3>${T("prismRectTitle")}</h3>
                <div class="step-title">${T("variables")}:</div>
                <p>\\( L = ${fmt(L)},\\ l = ${fmt(l)},\\ h = ${fmt(h)} \\)</p>
                <div class="step-title">${T("baseArea")}:</div>
                <p class="formula">\\( A_{base} = L \\times l \\)</p>
                <p>\\( A_{base} = ${fmt(L)}\\times ${fmt(l)} = ${fmt(baseA)} \\)</p>
                <div class="step-title">Base Perimeter:</div>
                <p>\\( P_{base} = 2(L+l) = ${fmt(baseP)} \\)</p>
                <div class="step-title">${T("lateralArea")}:</div>
                <p class="formula">\\( A_{lat} = P_{base}\\times h \\)</p>
                <p>\\( A_{lat} = ${fmt(baseP)}\\times ${fmt(h)} = ${fmt(A_lat)} \\)</p>
                <div class="step-title">${T("totalArea")}:</div>
                <p class="formula">\\( A_{tot} = A_{lat} + 2\\times A_{base} \\)</p>
                <p>\\( A_{tot} = ${fmt(A_lat)} + 2\\times ${fmt(baseA)} = ${fmt(A_tot)} \\)</p>
                <div class="step-title">${T("volume")}:</div>
                <p class="formula">\\( V = A_{base} \\times h \\)</p>
                <p>\\( V = ${fmt(baseA)}\\times ${fmt(h)} = ${fmt(V)} \\)</p>
              `;
            }
          }
          // (Other prism base types can be added similarly.)
        }
      }
      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      if (window.MathJax) { MathJax.typesetPromise(); }
    }

    // ============================================================
    // Measures from a Specific Area (plain text, improved spacing)
    // ============================================================
    function computeMeasuresArea() {
      const area = parseFloat(document.getElementById('inputArea').value);
      const solid = document.getElementById('selectSolidArea').value;
      let result = "";
      if (isNaN(area) || area<=0 || !solid) {
        result = currentLang==="fr"?"Entrée invalide.":"Invalid input.";
      } else {
        result = `For area = ${fmt(area)}, possible dimensions:\n\n`;
        if (solid==='sphere') {
          const r = Math.sqrt(area/(4*Math.PI));
          result += `Sphere: r = ${fmt(r)}`;
        }
        else if (solid==='cone') {
          for (let r = 1.0; r <= Math.sqrt(area); r += 0.01) {
            let g = (area - Math.PI*r*r) / (Math.PI*r);
            if (g > 0) {
              let h = Math.sqrt(g*g - r*r);
              if (g > 0 && validThousandths(g) &&
                  r/g > 0.30 && g/r > 0.30 &&
                  h/r > 0.30 && h/g > 0.40) {
                result += `Cone: r = ${fmt(r)}, h = ${fmt(h)}, g = ${fmt(g)}\n`;
              }
            }
          }
        }
        else if (solid==='cylindre') {
          for (let r = 1.0; r <= Math.sqrt(area); r += 0.1) {
            let h = (area - 2*Math.PI*r*r) / (2*Math.PI*r);
            if (h > 0 && validThousandths(h)) {
              result += `Cylinder: r = ${fmt(r)}, h = ${fmt(h)}\n`;
            }
          }
        }
        else if (solid==='cube') {
          let c = Math.sqrt(area/6);
          result += `Cube: edge = ${fmt(c)}`;
        }
        else if (solid==='prisme') {
          for (let a = 1.0; a <= Math.sqrt(area/2); a += 0.01) {
            let h = (area - 2*a*a) / (4*a);
            if (h > 0 && validThousandths(h) && a/h > 0.3 && h/a > 0.3) {
              let ap_base = a/2;
              let gen = Math.sqrt(h*h+ap_base*ap_base);
              if (gen > 0 && validThousandths(gen)) {
                result += `Prism (sq base): a = ${fmt(a)}, h = ${fmt(h)}, ap = ${fmt(ap_base)}, g = ${fmt(gen)}\n`;
              }
            }
          }
        }
        else if (solid==='pyramide') {
          for (let c = 1.0; c <= Math.sqrt(area); c += 0.01) {
            let Airelaterale = area - c*c;
            let aireTriangle = Airelaterale/4;
            let sh = 2*aireTriangle/c;
            let h = Math.sqrt(sh*sh - (c/2)*(c/2));
            if (h > 2 && validThousandths(h) && sh > 2 &&
                validThousandths(sh) && h/sh > 0.3 &&
                sh/h > 0.3 && c/h > 0.3 && h/c > 0.3) {
              result += `Pyramid (sq base): c = ${fmt(c)}, h = ${fmt(h)}, sh = ${fmt(sh)}\n`;
            }
          }
        }
      }
      const div = document.getElementById('resultArea');
      div.innerText = result;
      div.style.display = 'block';
    }

    // ============================================================
    // Measures from a Specific Volume (plain text, improved spacing)
    // ============================================================
    function computeMeasuresVolume() {
      const volume = parseFloat(document.getElementById('inputVolume').value);
      const solid = document.getElementById('selectSolidVolume').value;
      let result = "";
      if (isNaN(volume)||volume<=0||!solid) {
        result = currentLang==="fr"?"Entrée invalide.":"Invalid input.";
      } else {
        result = `For volume = ${fmt(volume)}, possible dimensions:\n\n`;
        if (solid==='sphere') {
          const r = Math.cbrt((3*volume)/(4*Math.PI));
          result += `Sphere: r = ${fmt(r)}`;
        }
        else if (solid==='cone') {
          for (let r = 0.5; r <= Math.cbrt(volume); r += 0.1) {
            let h = (3*volume)/(Math.PI*r*r);
            let g = Math.sqrt(r*r + h*h);
            if (g > 0 && validThousandths(g))
              result += `Cone: r = ${fmt(r)}, h = ${fmt(h)}, g = ${fmt(g)}\n`;
          }
        }
        else if (solid==='cylindre') {
          for (let r = 0.5; r <= Math.cbrt(volume); r += 0.1) {
            let h = volume/(Math.PI*r*r);
            if (h > 0 && validThousandths(h))
              result += `Cylinder: r = ${fmt(r)}, h = ${fmt(h)}\n`;
          }
        }
        else if (solid==='cube') {
          let c = Math.cbrt(volume);
          result += `Cube: edge = ${fmt(c)}`;
        }
        else if (solid==='prisme') {
          for (let a = 0.5; a <= Math.cbrt(volume); a += 0.1) {
            let h = volume/(a*a);
            if (h > 0 && validThousandths(h))
              result += `Prism (sq base): a = ${fmt(a)}, h = ${fmt(h)}\n`;
          }
        }
        else if (solid==='pyramide') {
          for (let c = 0.5; c <= Math.cbrt(volume*3); c += 0.1) {
            let h = (3*volume)/(c*c);
            if (h > 0 && validThousandths(h))
              result += `Pyramid (sq base): c = ${fmt(c)}, h = ${fmt(h)}\n`;
          }
        }
      }
      const div = document.getElementById('resultVolume');
      div.innerText = result;
      div.style.display = 'block';
    }
  </script>
</body>
</html>
